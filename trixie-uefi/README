Build trixie-uefi sdcard image for raspberrypi5:

cd ~/Downloads
wget https://cdimage.debian.org/debian-cd/current/arm64/iso-cd/debian-13.0.0-arm64-netinst.iso
wget https://github.com/worproject/rpi5-uefi/releases/download/v0.3/RPi5_UEFI_Release_v0.3.zip

cd ~/build-raspberrypi5/trixie-uefi

Plugin USB2 SATA ssd to PC.
sudo ./mksdcardimg.sh
sudo mkfs.vfat /dev/sda1
sudo fdisk -l /dev/sda
sudo mount -t vfat /dev/sda1 /mnt
sudo 7z x ~/Downloads/debian-13.0.0-arm64-netinst.iso -o/mnt && sync
sudo 7z x ~/Downloads/RPi5_UEFI_Release_v0.3.zip -o/mnt && sync && sudo umount /mnt
Eject USB2 SATA ssd from PC.

------------------------------------------------------------------------
Install trixie to USB2 SATA ssd.
NOTE: If on board fan is not turned on, use external fan.
      To minimize EMI interference, put USB2 sata ssd to rpi5 bottom USB2 socket,
      put wifi dongle to rpi5 top USB3 socket, put keyboard mouse to rpi5 bottom
      USB3 socket with USB2 extention cable.
------------------------------------------------------------------------

Plugin USB2 sata ssd to rpi5. Plugin USB wifi dongle to rpi5. Power on rpi5.
Select install
loading missing firmware? No
Select debian desktop and gnome in addition to ssh and standard system utilities.
User name: linaro

Disable power saving, turn off auto suspend and screen saver.
su -
usermod -aG adm,sudo,video linaro
sync
shutdown -h now

Power on rpi5.
sudo apt install openssh-server net-tools pulseaudio-utils
sudo ifconfig
uname -a
lsb_release -a
sudo apt update; sudo apt upgrade -y;
sync
free
Check if Debian is running UEFI mode:
ls /sys/firmware/efi
Check display mode: ( wayland or x11 )
echo $XDG_SESSION_TYPE
Check audio driver: ( pulseaudio or pipewire )
pactl info

sudo apt install build-essential speedtest-cli python3-pip python3-setuptools glmark2-es2 rfkill

speedtest-cli --secure

glmark2-es2

aplay -l
sudo rfkill list

mainline kernel 6.12.41+deb13-arm64 doesn't support rpi5 fan, sound, bluetooth, wifi, ethernet.

-------------------------------------------------------------
Compile vendor's kernel 6.17.0-rc3-v8-16k+ with ovmerge
-------------------------------------------------------------

sudo apt install git cmake device-tree-compiler libfdt-dev build-essential libncurses-dev bison flex libssl-dev libelf-dev fakeroot

git clone https://github.com/raspberrypi/linux --depth=1 -b rpi-6.17.y
vi ./linux/arch/arm64/configs/bcm2712_defconfig ( delete CONFIG_CMDLINE, change CONFIG_I2C_CHARDEV=m to CONFIG_I2C_CHARDEV=y )

Install ovmerge from  https://github.com/raspberrypi/utils
git clone https://github.com/raspberrypi/utils.git
cd utils
cmake .
make
sudo make install
which ovmerge
cd ../linux/arch/arm64/boot/dts/broadcom

To enable fan:
vi bcm2712-rpi-5-b.dts ( search fan: cooling_fan change disabled to okay, search &rp1_pwm1 change disabled to okay )
cp bcm2712-rpi-5-b.dts bcm2712-rpi-5-b.dts.org
ovmerge -c -p bcm2712-rpi-5-b.dts,i2c1=on,i2c_arm=on,spi=on ../overlays/uart2-pi5-overlay.dts ../overlays/vc4-kms-v3d-pi5-overlay.dts,cma-512 > custom.dts
cp custom.dts bcm2712-rpi-5-b.dts
cd ~/linux
sudo make mrproper
make ARCH=arm64 bcm2712_defconfig
make ARCH=arm64 all -j$(nproc)           ( this may take 2 hours to compile )
sudo make ARCH=arm64 modules_install
sudo make ARCH=arm64 dtbs_install
sudo make ARCH=arm64 install

cd ../
ls -la /boot
df .
sudo e2label /dev/sda3 rootfs
sudo blkid /dev/sda3   ( look for LABEL and UUID )

sudo vi /etc/grub.d/40_custom_uuid ( add
#!/bin/sh
exec tail -n +3 $0

menuentry "Boot from UUID" {
    search --no-floppy --fs-uuid --set=root --hint='usb0,gpt2' --hint='mmcblk0,gpt2' --hint='mmcblk1,gpt2' 33004b37-9617-45ac-b564-1f449ac9daca
    echo    'Loading Linux 6.17.0-rc3-v8-16k+ ...'
    linux /boot/vmlinux-6.17.0-rc3-v8-16k+ root=LABEL=rootfs rootwait rw video=HDMI-A-1:1920x1080@60
    echo    'Loading initial ramdisk ...'
    initrd /boot/initrd.img-6.17.0-rc3-v8-16k+
    devicetree /boot/dtbs/6.17.0-rc3-v8-16k+/broadcom/bcm2712-rpi-5-b.dtb
}
)

Note: change the above UUID to real UUID like: b3adbe54-ab88-4da5-a9a6-08cf87a09d69

sudo chmod +x /etc/grub.d/40_custom_uuid

sudo vi /etc/default/grub ( change GRUB_DEFAULT=0 to GRUB_DEFAULT="Boot from UUID" )
sudo update-grub  ( generate grub.cfg )
sync
sudo shutdown -h now

Plugin USB2 SATA SSD to PC.
sudo mount /dev/sda3 /mnt
sudo cp ./packages/brcmfmac43455* /mnt/lib/firmware/brcm/
sudo cp ./packages/BCM4345C0* /mnt/lib/firmware/brcm/
sudo mkdir /mnt/lib/firmware/rtl_bt
sudo cp ./packages/rtl* /mnt/lib/firmware/rtl_bt/
sync
sudo umount /mnt
Eject USB2 SATA SSD from PC.

Plugin USB2 SATA SSD to rpi5. Remove wifi usb dongle. Power on rpi5.
Forget wifi. Setup wifi.
sudo ifconfig
uname -a
lsb_release -a

Check CPU speed:
cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq

Check fan:
cat /proc/device-tree/cooling_fan/status
cat /sys/class/thermal/cooling_device0/type

Check if Debian is running UEFI mode:
ls /sys/firmware/efi

Install mesa 25:
sudo vi /etc/apt/sources.list ( add
deb http://archive.raspberrypi.org/debian trixie main
)
wget https://archive.raspberrypi.org/debian/raspberrypi.gpg.key -O - | gpg --dearmor | sudo tee /etc/apt/trusted.gpg.d/raspberrypi5-keys.gpg > /dev/null
sudo apt update
sudo apt upgrade -y
sudo apt remove orca -y
sync
sudo reboot

sudo apt install git zip rfkill speedtest-cli python3-pip python3-setuptools ffmpeg mpv glmark2-es2-wayland pandoc firefox-esr vlc vlc-plugin-video-output pavucontrol

speedtest-cli --secure

glmark2-es2-wayland

aplay -l
pavucontrol  ( select hdmi as default )

firefox -> youtube.com -> search YmDNhi07_Ho

git clone https://github.com/yt-dlp/yt-dlp.git
cd yt-dlp
make
cd ../
~/yt-dlp/yt-dlp -f 'bestvideo[ext=mp4]+bestaudio[ext=m4a]' 3qrKjywjo7Q -o swan-temp.mp4 --merge-output-format mp4 && ffmpeg -hide_banner -loglevel error -i swan-temp.mp4 -c:v libx265 -pix_fmt yuv420p -crf 28 -preset faster -c:a copy swan.mp4   ( It may take 15 minutes )

mpv --hwdec=auto-copy swan.mp4
ffplay swan.mp4
cvlc --gl=wgl --glconv=any swan.mp4

Plugin ASUS USB-BT500 bluetooth usb dongle to rpi5.
sudo rfkill list
hciconfig hci0
hcitool dev
hciconfig -a
